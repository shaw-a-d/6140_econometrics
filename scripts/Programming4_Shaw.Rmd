#Simulating data
set.seed(1935)
n=10000
x2=runif(n, min = 0, max = 10)
x1=rnorm(n,mean=8, 3)+0.3*x2
e=rnorm(n,mean=0,sd=1)
y=0.1+0.08*x2 + 0.02*x1+e



#Above I've simulated data based on y being a function of x1, x2, and e


#Problem 1: Using the formula for single variate models (covariances and variances) estimate a model y that's based only on x1.
```{r model_x1}

model_1 <- lm(y~x1)
model_1


```

#Problem 2: Now estimate the covariance between x1 and x2 and the variance of x1.
```{r}

cov_x1x2 <- cov(x1, x2)
var_x1 <- var(x1)

coeff <- cov_x1x2/var_x1
coeff


```

#Problem 3: Based on what you know from the way the data was created what is your best guess for omitted variable bias?

```{r}

coeff * 0.08 + 0.040755


```

b1 + b2 cov(x1,x2)/var(x1)


#Problem 4: imagine x1 is a treatment with some drug. Describe why randomizing x1 will give you the correct estimate of the effect of x1 on y? 


#Problem 5: run 10 regressions of x1 on y (using the lm(y~x1) function) within groups of x2. I.E. run a set of regressions of x1 on y where x2 equals 0 to 0.1, 0.1 to 0.2, 0.2 to 0.3, etc (don't include the same observations in any regressions. Take the weighted average of the estimates from each of these regressions where you weight by the number of observations in each of these regressions multiplied by the coefficients. What percent of the bias does this estimate have in comparison to your estimate from problem 1?

What would be the estimated bias if you ran the sim. many times?

est. b1 = b1+b2*cov(x,x2)/var(x1)



#Using data from the birth records in 2017
rm(list=ls())
births=load("C:/Users/Daniel/Desktop/samplebirth2017.RData")

#Problem 6 Create a multivariate model that best predicts the effects of various characteristics on birth weight which is variable dbwt. Be sure to get rid of the missing variables (see the codebook on canvas).  You must use at least five variables (a set of dummy variables counts as one). Show your results in a table in RMarkdown. Describe the results.

#Problem 7 Create a scatter-plot of your residuals on the y-axis against at least one continuous independent variable on the x-axis. Include this in your RMarkdown file along with a description of the results.

